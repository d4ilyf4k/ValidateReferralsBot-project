from db.finance import get_user_applications

BANK_TITLES = {
    "t-bank": "–¢-–ë–∞–Ω–∫",
    "alpha": "–ê–ª—å—Ñ–∞-–ë–∞–Ω–∫"
}

BANK_LABELS = {
    "t-bank": "üè¶ –¢-–ë–∞–Ω–∫",
    "sber": "üè¶ –°–±–µ—Ä–ë–∞–Ω–∫",
    "vtb": "üè¶ –í–¢–ë",
    "alfa": "üè¶ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫",
}

async def generate_user_finance_report(user_id: int) -> str:
    applications = await get_user_applications(user_id)
    
    if not applications:
        return (
            "üí∞ <b>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç</b>\n\n"
            "–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤.\n\n"
            "–í—ã–±–µ—Ä–∏—Ç–µ –±–∞–Ω–∫ –∏ –∫–∞—Ä—Ç—É ‚Äî –ø–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è "
            "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å."
        )

    lines = [
        "üí∞ <b>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç</b>\n",
        "<i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–æ—Å–∏—Ç —Å–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä.</i>\n"
    ]

    for app in applications:
        bank_label = BANK_LABELS.get(app["bank_key"], app["bank_key"])

        lines.append(
            f"{bank_label}\n"
            f"‚Ä¢ –ü—Ä–æ–¥—É–∫—Ç: {app['product_key']}\n"
            f"‚Ä¢ –°—Ç–∞—Ç—É—Å: –ø–µ—Ä–µ–¥–∞–Ω–æ –±–∞–Ω–∫—É\n"
            f"‚Ä¢ –î–∞—Ç–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è: {app['created_at']}\n"
        )
    
    lines.append(
        "\n‚ÑπÔ∏è <b>–í–∞–∂–Ω–æ:</b>\n"
        "–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –±–∞–Ω–∫–æ–º\n"
        "–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –µ–≥–æ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ —Å—Ä–æ–∫–∞–º–∏."
    )

    return "\n".join(lines)
